// Because this is for testing it's global
var test_data = {
    "position": {
        "X": 0,
        "Y": 0
    },
    "owner": "jswdhsakasdsd",
    "data": [
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 14
            },
            {
                "height": 0,
                "ground": 1,
                "build": 14
            },
            {
                "height": 0,
                "ground": 1,
                "build": 14
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 0,
                "build": 0
            },
            {
                "height": 0,
                "ground": 0,
                "build": 0
            },
            {
                "height": 0,
                "ground": 4,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 0,
                "build": 0
            },
            {
                "height": 0,
                "ground": 4,
                "build": 0
            },
            {
                "height": 0,
                "ground": 8,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 0,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 0,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 1
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 4,
                "build": 0
            },
            {
                "height": 0,
                "ground": 8,
                "build": 0
            },
            {
                "height": 1,
                "ground": 0,
                "build": 15
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 2
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 5,
                "build": 0
            },
            {
                "height": 0,
                "ground": 9,
                "build": 0
            },
            {
                "height": 0,
                "ground": 6,
                "build": 0
            }
        ],
        [
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 1,
                "build": 0
            },
            {
                "height": 0,
                "ground": 0,
                "build": 0
            },
            {
                "height": 0,
                "ground": 5,
                "build": 0
            },
            {
                "height": 0,
                "ground": 2,
                "build": 0
            }
        ]
    ]
};

// This get automatically called
function main() {
    // That's where we store our map
    var map_storage = new MapStorage();
    map_storage.setChunk(0,0,test_data);
    map_storage.setChunk(1,1,test_data);
    map_storage.setChunk(0,1,test_data);
    map_storage.setChunk(1,0,test_data);
    
    // Start user handler
    var user_handler = new UserHandler();
    user_handler.assignEvents();
    
    // Init rendering parts
    var canvas = elementID("main-canvas");
    var render_engine = new RenderEngine(canvas);
    
    // Store those modules in an object to
    // pass modules by reference
    var modules = {
        map_storage: map_storage,
        user_handler: user_handler,
        render_engine: render_engine,
        canvas: canvas
    }
    
    // Start game loop
    setInterval(game_loop, 100, modules);
}

function game_loop(md) {
    // Update canvas size
    updateSize();
    // Handle user events
    
    // Now we can update the map
    md.render_engine.render(md.user_handler.zoom, [.5, .5], md.map_storage);
        console.log('render')
}
